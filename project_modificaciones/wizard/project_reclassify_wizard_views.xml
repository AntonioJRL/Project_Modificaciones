<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- VISTA FORM DEL WIZARD (WORK LIST PATTERN) -->
    <record id="view_project_reclassify_wizard_form" model="ir.ui.view">
        <field name="name">project.reclassify.wizard.form</field>
        <field name="model">project.reclassify.wizard</field>
        <field name="arch" type="xml">
            <form string="Reclasificaci칩n">
                <sheet>
                    <div class="alert alert-info" role="alert">
                        <strong>Ayuda:</strong> Seleccione el nuevo destino
                        (Proyecto/Tarea/Anal칤tica). Los registros listados abajo ser치n actualizados.
                        Puede <b>deseleccionar registros</b> de la lista si no desea procesarlas. </div>

                    <group string="Valores de Reclasificaci칩n">
                        <group>
                            <field name="project_id" options="{'no_create': True, 'no_open': True}" />
                            <field name="analytic_distribution" widget="analytic_distribution" />
                            <field name="analytic_precision" invisible="1" />
                        </group>
                        <group>
                            <field name="task_id"
                                context="{'default_project_id': project_id}"
                                options="{'no_create': True, 'no_open': True}" />
                        </group>
                    </group>

                    <separator string="Registros a Procesar" />

                    <!-- 1. Compras -->
                    <group invisible="not purchase_line_ids">
                        <field name="purchase_line_ids" nolabel="1" colspan="2">
                            <tree editable="bottom" create="0" delete="1">
                                <field name="order_id" readonly="1" string="ID Orden" />
                                <field name="product_id" readonly="1" />
                                <field name="name" readonly="1" optional="hide" />
                                <field name="project_id" readonly="1" string="Proy. Actual" />
                                <field name="task_id" readonly="1" string="Tarea Actual" />
                                <field name="analytic_distribution" widget="analytic_distribution"
                                    readonly="1" string="Distribuci칩n Actual" />
                            </tree>
                        </field>
                    </group>

                    <!-- 2. Compensaciones -->
                    <group invisible="not compensation_line_ids">
                        <field name="compensation_line_ids" nolabel="1" colspan="2">
                            <tree editable="bottom" create="0" delete="1">
                                <field name="employee_id" readonly="1" />
                                <field name="date" readonly="1" />
                                <field name="project_id" readonly="1" string="Proy. Actual" />
                                <field name="task_id" readonly="1" string="Tarea Actual" />
                                <field name="monetary_compensation" readonly="1" />
                            </tree>
                        </field>
                    </group>

                    <!-- 3. Requisiciones -->
                    <group invisible="not requisition_line_ids">
                        <field name="requisition_line_ids" nolabel="1" colspan="2">
                            <tree editable="bottom" create="0" delete="1">
                                <field name="product_id" readonly="1" />
                                <field name="description" readonly="1" />
                                <field name="quantity" readonly="1" />
                                <field name="analytic_distribution" widget="analytic_distribution"
                                    readonly="1" />
                            </tree>
                        </field>
                    </group>

                    <!-- 4. Gastos -->
                    <group invisible="not expense_line_ids">
                        <field name="expense_line_ids" nolabel="1" colspan="2">
                            <tree editable="bottom" create="0" delete="1">
                                <field name="date" readonly="1" />
                                <field name="employee_id" readonly="1" />
                                <field name="name" readonly="1" />
                                <field name="project_id" readonly="1" string="Proy. Actual" />
                                <field name="task_id" readonly="1" string="Tarea Actual" />
                                <field name="analytic_distribution" widget="analytic_distribution"
                                    readonly="1" />
                                <field name="total_amount" readonly="1" />
                            </tree>
                        </field>
                    </group>

                    <!-- 5. Stock Moves -->
                    <group invisible="not stock_move_ids">
                        <field name="stock_move_ids" nolabel="1" colspan="2">
                            <tree editable="bottom" create="0" delete="1">
                                <field name="date" readonly="1" />
                                <field name="product_id" readonly="1" />
                                <field name="project_id" readonly="1" string="Proy. Actual" />
                                <field name="task_id" readonly="1" string="Tarea Actual" />
                                <field name="state" readonly="1" />
                            </tree>
                        </field>
                    </group>

                    <!-- 6. Apuntes Contables -->
                    <group invisible="not move_line_ids">
                        <field name="move_line_ids" nolabel="1" colspan="2">
                            <tree editable="bottom" create="0" delete="1">
                                <field name="move_id" readonly="1" string="Asiento" />
                                <field name="date" readonly="1" />
                                <field name="account_id" readonly="1" />
                                <field name="name" readonly="1" />
                                <field name="analytic_distribution" widget="analytic_distribution"
                                    readonly="1" />
                                <field name="debit" readonly="1" />
                                <field name="credit" readonly="1" />
                            </tree>
                        </field>
                    </group>

                    <!-- 7. L칤neas Anal칤ticas -->
                    <group invisible="not analytic_line_ids">
                        <field name="analytic_line_ids" nolabel="1" colspan="2">
                            <tree editable="bottom" create="0" delete="1">
                                <field name="date" readonly="1" />
                                <field name="project_id" readonly="1" string="Proy. Actual" />
                                <field name="task_id" readonly="1" string="Tarea Actual" />
                                <field name="name" readonly="1" />
                                <field name="amount" readonly="1" />
                            </tree>
                        </field>
                    </group>

                    <footer>
                        <button name="action_reclassify" string="Reclasificar" type="object"
                            class="btn-primary" />
                        <button string="Cancelar" class="btn-secondary" special="cancel" />
                    </footer>
                </sheet>
            </form>
        </field>
    </record>

    <!-- ACCIONES DE VENTANA (BINDINGS) -->

    <!-- 1. COMPRAS (purchase.order) -->
    <record id="action_project_reclassify_purchase_order" model="ir.actions.act_window">
        <field name="name">游댃Reclasificar</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">project.reclassify.wizard</field>
        <field name="view_mode">form</field>
        <field name="view_id" ref="view_project_reclassify_wizard_form" />
        <field name="target">new</field>
        <field name="binding_model_id" ref="purchase.model_purchase_order" />
        <field name="binding_view_types">list,form</field>
    </record>

    <!-- 2. L칈NEAS DE COMPRA (purchase.order.line) -->
    <record id="action_project_reclassify_purchase_line" model="ir.actions.act_window">
        <field name="name">游댃Reclasificar</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">project.reclassify.wizard</field>
        <field name="view_mode">form</field>
        <field name="view_id" ref="view_project_reclassify_wizard_form" />
        <field name="target">new</field>
        <field name="binding_model_id" ref="purchase.model_purchase_order_line" />
        <field name="binding_view_types">list</field>
    </record>

    <!-- 3. STOCK PICKING (stock.picking) -->
    <record id="action_project_reclassify_stock_picking" model="ir.actions.act_window">
        <field name="name">游댃Reclasificar</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">project.reclassify.wizard</field>
        <field name="view_mode">form</field>
        <field name="view_id" ref="view_project_reclassify_wizard_form" />
        <field name="target">new</field>
        <field name="binding_model_id" ref="stock.model_stock_picking" />
        <field name="binding_view_types">list,form</field>
    </record>

    <!-- 4. STOCK MOVE (stock.move) -->
    <record id="action_project_reclassify_stock_move" model="ir.actions.act_window">
        <field name="name">游댃Reclasificar</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">project.reclassify.wizard</field>
        <field name="view_mode">form</field>
        <field name="view_id" ref="view_project_reclassify_wizard_form" />
        <field name="target">new</field>
        <field name="binding_model_id" ref="stock.model_stock_move" />
        <field name="binding_view_types">list</field>
    </record>

    <!-- 5. ANALYTIC LINES (account.analytic.line) - HOJAS DE HORAS / COSTOS -->
    <record id="action_project_reclassify_analytic_line" model="ir.actions.act_window">
        <field name="name">游댃Reclasificar</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">project.reclassify.wizard</field>
        <field name="view_mode">form</field>
        <field name="view_id" ref="view_project_reclassify_wizard_form" />
        <field name="target">new</field>
        <field name="binding_model_id" ref="analytic.model_account_analytic_line" />
        <field name="binding_view_types">list</field>
    </record>

    <!-- 6. ACCOUNT MOVE LINES (account.move.line) - APUNTES CONTABLES -->
    <record id="action_project_reclassify_account_move_line" model="ir.actions.act_window">
        <field name="name">Reclasificar Anal칤tica 游댃</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">project.reclassify.wizard</field>
        <field name="view_mode">form</field>
        <field name="view_id" ref="view_project_reclassify_wizard_form" />
        <field name="target">new</field>
        <field name="binding_model_id" ref="account.model_account_move_line" />
        <field name="binding_view_types">list</field>
    </record>

    <!-- 6b. ACCOUNT MOVES (account.move) - ASIENTOS CONTABLES -->
    <record id="action_project_reclassify_account_move" model="ir.actions.act_window">
        <field name="name">Reclasificar Asiento 游댃</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">project.reclassify.wizard</field>
        <field name="view_mode">form</field>
        <field name="view_id" ref="view_project_reclassify_wizard_form" />
        <field name="target">new</field>
        <field name="binding_model_id" ref="account.model_account_move" />
        <field name="binding_view_types">list,form</field>
    </record>

    <!-- 7. ATTENDANCE / COMPENSATION LINES (compensation.line) -->
    <!-- Nota: Asumimos que el m칩dulo attendance_regularization est치 instalado o en depends, 
         pero para evitar errores si no lo est치, idealmente esto deber칤a ir en un archivo separado 
         o cargarse condicionalmente. Como el usuario confirm칩 su existencia en el entorno, lo agregamos
    aqu칤. -->
    <record id="action_project_reclassify_compensation_line" model="ir.actions.act_window">
        <field name="name">游댃Reclasificar</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">project.reclassify.wizard</field>
        <field name="view_mode">form</field>
        <field name="view_id" ref="view_project_reclassify_wizard_form" />
        <field name="target">new</field>
        <!-- Referencia d칠bil o directa si estamos seguros del depends -->
        <field name="binding_model_id" ref="attendance_regularization.model_compensation_line" />
        <field name="binding_view_types">list</field>
    </record>

    <!-- 8. GASTOS (hr.expense) -->
    <record id="action_project_reclassify_hr_expense" model="ir.actions.act_window">
        <field name="name">游댃Reclasificar</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">project.reclassify.wizard</field>
        <field name="view_mode">form</field>
        <field name="view_id" ref="view_project_reclassify_wizard_form" />
        <field name="target">new</field>
        <field name="binding_model_id" ref="hr_expense.model_hr_expense" />
        <field name="binding_view_types">list,form</field>
    </record>

    <!-- 9. REPORTES DE GASTOS (hr.expense.sheet) -->
    <record id="action_project_reclassify_hr_expense_sheet" model="ir.actions.act_window">
        <field name="name">游댃Reclasificar</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">project.reclassify.wizard</field>
        <field name="view_mode">form</field>
        <field name="view_id" ref="view_project_reclassify_wizard_form" />
        <field name="target">new</field>
        <field name="binding_model_id" ref="hr_expense.model_hr_expense_sheet" />
        <field name="binding_view_types">list,form</field>
    </record>

    <!-- 10. REQUISICIONES DE EMPLEADO (employee.purchase.requisition) -->
    <record id="action_project_reclassify_employee_purchase_requisition"
        model="ir.actions.act_window">
        <field name="name">游댃Reclasificar</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">project.reclassify.wizard</field>
        <field name="view_mode">form</field>
        <field name="view_id" ref="view_project_reclassify_wizard_form" />
        <field name="target">new</field>
        <field name="binding_model_id"
            ref="employee_purchase_requisition.model_employee_purchase_requisition" />
        <field name="binding_view_types">list,form</field>
    </record>

    <!-- 11. SOLICITUDES DE COMPENSACI칍N (compensation.request) -->
    <record id="action_project_reclassify_compensation_request"
        model="ir.actions.act_window">
        <field name="name">游댃Reclasificar</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">project.reclassify.wizard</field>
        <field name="view_mode">form</field>
        <field name="view_id" ref="view_project_reclassify_wizard_form" />
        <field name="target">new</field>
        <field name="binding_model_id"
            ref="attendance_regularization.model_compensation_request" />
        <field name="binding_view_types">list,form</field>
    </record>

</odoo>